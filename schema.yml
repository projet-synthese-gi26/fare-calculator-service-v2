openapi: 3.0.3
info:
  title: Fare Calculator API
  version: 2.0.0
  description: API REST pour estimation prix taxi au Cameroun
  contact:
    email: donfackarthur750@gmail.com
paths:
  /api/abonnements/:
    get:
      operationId: abonnements_list
      description: |-
        ViewSet pour consulter les abonnements.

        Endpoints :
            GET /api/abonnements/ : Liste tous les abonnements
            GET /api/abonnements/{id}/ : Détail d'un abonnement
            GET /api/abonnements/verifier/{publicite_id}/ : Vérifier l'abonnement d'une pub
      tags:
      - abonnements
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Abonnement'
          description: ''
  /api/abonnements/{id}/:
    get:
      operationId: abonnements_retrieve
      description: |-
        ViewSet pour consulter les abonnements.

        Endpoints :
            GET /api/abonnements/ : Liste tous les abonnements
            GET /api/abonnements/{id}/ : Détail d'un abonnement
            GET /api/abonnements/verifier/{publicite_id}/ : Vérifier l'abonnement d'une pub
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Abonnement.
        required: true
      tags:
      - abonnements
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Abonnement'
          description: ''
  /api/abonnements/verifier/{publicite_id}/:
    get:
      operationId: abonnements_verifier_retrieve
      description: |-
        Vérifie si une publicité a un abonnement actif.
        Utilisé pour contrôler l'accès à la page Stats.
      parameters:
      - in: path
        name: publicite_id
        schema:
          type: integer
          title: Publicité
        required: true
      tags:
      - abonnements
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Abonnement'
          description: ''
  /api/add-trajet/:
    post:
      operationId: add_trajet_create
      description: Endpoint POST /api/add-trajet/
      tags:
      - add-trajet
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Trajet'
        required: true
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trajet'
          description: ''
  /api/contact-info/:
    get:
      operationId: contact_info_retrieve
      description: Retourne les informations de contact.
      tags:
      - contact-info
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          description: No response body
  /api/estimate/:
    get:
      operationId: estimate_retrieve
      description: "\n        Endpoint GET /api/estimate/ avec paramètres URL (alternative
        au POST).\n        \n        **Flexibilité des paramètres :**\n        - Les
        coordonnées (lat/lon) sont **requises** en GET.\n        - Les paramètres
        `heure`, `meteo`, `type_zone`, `congestion_user` sont **optionnels** (détectés/déduits
        automatiquement).\n        - Format identique au POST en termes de logique
        estimation.\n        \n        **Exemple URL :**\n        ```\n        GET
        /api/estimate/?depart_lat=3.8547&depart_lon=11.5021&arrivee_lat=3.8667&arrivee_lon=11.5174&heure=matin&meteo=0\n
        \       ```\n        "
      parameters:
      - in: query
        name: arrivee_lat
        schema:
          type: number
          format: double
        description: Latitude du point d'arrivée (coordonnées)
        required: true
      - in: query
        name: arrivee_lon
        schema:
          type: number
          format: double
        description: Longitude du point d'arrivée (coordonnées)
        required: true
      - in: query
        name: congestion_user
        schema:
          type: integer
        description: 'Niveau de congestion perçu (optionnel: 0-10). Défaut=5 (neutre)
          si omis.'
      - in: query
        name: depart_lat
        schema:
          type: number
          format: double
        description: Latitude du point de départ (coordonnées)
        required: true
      - in: query
        name: depart_lon
        schema:
          type: number
          format: double
        description: Longitude du point de départ (coordonnées)
        required: true
      - in: query
        name: heure
        schema:
          type: string
        description: 'Heure du trajet (optionnel: matin|apres-midi|soir|nuit). Détectée
          automatiquement si omise.'
      - in: query
        name: meteo
        schema:
          type: integer
        description: 'Condition météo (optionnel: 0=soleil|1=pluie-legere|2=pluie-forte|3=orage).
          Détectée automatiquement via API si omise.'
      - in: query
        name: type_zone
        schema:
          type: integer
        description: 'Type de zone (optionnel: 0=urbain|1=periurbain|2=rural). Déduit
          automatiquement si omis.'
      tags:
      - estimate
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionOutput'
          description: ''
    post:
      operationId: estimate_create
      description: Estimer le prix d'un trajet taxi. Accepte coordonnées OU noms de
        lieux. Variables (heure, météo, zone) détectées automatiquement si manquantes.
      tags:
      - estimate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EstimateInput'
        required: true
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionOutput'
          description: ''
  /api/health/:
    get:
      operationId: health_retrieve
      description: |-
        View santé API : GET /api/health/

        Vérifie :
            - Django répond
            - BD accessible
            - Redis/Celery connecté
            - APIs externes (Mapbox, Nominatim, OpenMeteo) accessibles (optionnel)

        Retourne :
            {
                "status": "healthy",
                "timestamp": "2023-11-05T14:30:00Z",
                "checks": {
                    "database": "ok",
                    "redis": "ok",
                    "mapbox": "ok",
                    "nominatim": "ok",
                    "openmeteo": "ok"
                }
            }
      tags:
      - health
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheck'
          description: ''
  /api/offres-abonnement/:
    get:
      operationId: offres_abonnement_list
      description: |-
        ViewSet lecture seule pour les offres d'abonnement.
        Utilisé pour la page Pricing.

        Endpoints :
            GET /api/offres-abonnement/ : Liste toutes les offres actives
            GET /api/offres-abonnement/{id}/ : Détail d'une offre
      tags:
      - offres-abonnement
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OffreAbonnement'
          description: ''
  /api/offres-abonnement/{id}/:
    get:
      operationId: offres_abonnement_retrieve
      description: |-
        ViewSet lecture seule pour les offres d'abonnement.
        Utilisé pour la page Pricing.

        Endpoints :
            GET /api/offres-abonnement/ : Liste toutes les offres actives
            GET /api/offres-abonnement/{id}/ : Détail d'une offre
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Offre d'Abonnement.
        required: true
      tags:
      - offres-abonnement
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OffreAbonnement'
          description: ''
  /api/points/:
    get:
      operationId: points_list
      description: |-
        ViewSet lecture seule pour Points d'intérêt.

        Endpoints :
            GET /api/points/ : Liste tous points
            GET /api/points/{id}/ : Détail point
            GET /api/points/?quartier=Ekounou : Filtrage par quartier
            GET /api/points/?ville=Yaoundé : Filtrage par ville

        Utilisé principalement admin/debug. Frontend utilise Search API Mapbox pour auto-complétion.
      parameters:
      - in: query
        name: arrondissement
        schema:
          type: string
      - in: query
        name: quartier
        schema:
          type: string
      - in: query
        name: ville
        schema:
          type: string
      tags:
      - points
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Point'
          description: ''
  /api/points/{id}/:
    get:
      operationId: points_retrieve
      description: |-
        ViewSet lecture seule pour Points d'intérêt.

        Endpoints :
            GET /api/points/ : Liste tous points
            GET /api/points/{id}/ : Détail point
            GET /api/points/?quartier=Ekounou : Filtrage par quartier
            GET /api/points/?ville=Yaoundé : Filtrage par ville

        Utilisé principalement admin/debug. Frontend utilise Search API Mapbox pour auto-complétion.
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Point d'Intérêt.
        required: true
      tags:
      - points
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Point'
          description: ''
  /api/publicites/:
    get:
      operationId: publicites_list
      description: |-
        ViewSet pour les publicités (partenaires).

        Endpoints :
            GET /api/publicites/ : Liste toutes les pubs affichables (actives + abonnement valide)
            GET /api/publicites/{id}/ : Détail d'une pub
            POST /api/publicites/ : Soumettre une demande de publicité (avec choix d'offre)
            GET /api/publicites/{id}/stats/ : Stats de la pub (pour le partenaire)
      tags:
      - publicites
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Publicite'
          description: ''
    post:
      operationId: publicites_create
      description: |-
        ViewSet pour les publicités (partenaires).

        Endpoints :
            GET /api/publicites/ : Liste toutes les pubs affichables (actives + abonnement valide)
            GET /api/publicites/{id}/ : Détail d'une pub
            POST /api/publicites/ : Soumettre une demande de publicité (avec choix d'offre)
            GET /api/publicites/{id}/stats/ : Stats de la pub (pour le partenaire)
      tags:
      - publicites
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PubliciteCreate'
        required: true
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PubliciteCreate'
          description: ''
  /api/publicites/{id}/:
    get:
      operationId: publicites_retrieve
      description: |-
        ViewSet pour les publicités (partenaires).

        Endpoints :
            GET /api/publicites/ : Liste toutes les pubs affichables (actives + abonnement valide)
            GET /api/publicites/{id}/ : Détail d'une pub
            POST /api/publicites/ : Soumettre une demande de publicité (avec choix d'offre)
            GET /api/publicites/{id}/stats/ : Stats de la pub (pour le partenaire)
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Publicité (Service Partenaire).
        required: true
      tags:
      - publicites
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Publicite'
          description: ''
    put:
      operationId: publicites_update
      description: |-
        ViewSet pour les publicités (partenaires).

        Endpoints :
            GET /api/publicites/ : Liste toutes les pubs affichables (actives + abonnement valide)
            GET /api/publicites/{id}/ : Détail d'une pub
            POST /api/publicites/ : Soumettre une demande de publicité (avec choix d'offre)
            GET /api/publicites/{id}/stats/ : Stats de la pub (pour le partenaire)
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Publicité (Service Partenaire).
        required: true
      tags:
      - publicites
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Publicite'
        required: true
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Publicite'
          description: ''
    patch:
      operationId: publicites_partial_update
      description: |-
        ViewSet pour les publicités (partenaires).

        Endpoints :
            GET /api/publicites/ : Liste toutes les pubs affichables (actives + abonnement valide)
            GET /api/publicites/{id}/ : Détail d'une pub
            POST /api/publicites/ : Soumettre une demande de publicité (avec choix d'offre)
            GET /api/publicites/{id}/stats/ : Stats de la pub (pour le partenaire)
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Publicité (Service Partenaire).
        required: true
      tags:
      - publicites
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchedPublicite'
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Publicite'
          description: ''
    delete:
      operationId: publicites_destroy
      description: |-
        ViewSet pour les publicités (partenaires).

        Endpoints :
            GET /api/publicites/ : Liste toutes les pubs affichables (actives + abonnement valide)
            GET /api/publicites/{id}/ : Détail d'une pub
            POST /api/publicites/ : Soumettre une demande de publicité (avec choix d'offre)
            GET /api/publicites/{id}/stats/ : Stats de la pub (pour le partenaire)
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Publicité (Service Partenaire).
        required: true
      tags:
      - publicites
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '204':
          description: No response body
  /api/publicites/{id}/stats/:
    get:
      operationId: publicites_stats_retrieve
      description: |-
        Statistiques d'une publicité pour le partenaire.
        Vérifie que l'abonnement est valide avant de donner accès.
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Publicité (Service Partenaire).
        required: true
      tags:
      - publicites
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Publicite'
          description: ''
  /api/schema/:
    get:
      operationId: schema_retrieve
      description: |-
        OpenApi3 schema for this API. Format can be selected via content negotiation.

        - YAML: application/vnd.oai.openapi
        - JSON: application/vnd.oai.openapi+json
      parameters:
      - in: query
        name: format
        schema:
          type: string
          enum:
          - json
          - yaml
      - in: query
        name: lang
        schema:
          type: string
          enum:
          - af
          - ar
          - ar-dz
          - ast
          - az
          - be
          - bg
          - bn
          - br
          - bs
          - ca
          - ckb
          - cs
          - cy
          - da
          - de
          - dsb
          - el
          - en
          - en-au
          - en-gb
          - eo
          - es
          - es-ar
          - es-co
          - es-mx
          - es-ni
          - es-ve
          - et
          - eu
          - fa
          - fi
          - fr
          - fy
          - ga
          - gd
          - gl
          - he
          - hi
          - hr
          - hsb
          - hu
          - hy
          - ia
          - id
          - ig
          - io
          - is
          - it
          - ja
          - ka
          - kab
          - kk
          - km
          - kn
          - ko
          - ky
          - lb
          - lt
          - lv
          - mk
          - ml
          - mn
          - mr
          - ms
          - my
          - nb
          - ne
          - nl
          - nn
          - os
          - pa
          - pl
          - pt
          - pt-br
          - ro
          - ru
          - sk
          - sl
          - sq
          - sr
          - sr-latn
          - sv
          - sw
          - ta
          - te
          - tg
          - th
          - tk
          - tr
          - tt
          - udm
          - ug
          - uk
          - ur
          - uz
          - vi
          - zh-hans
          - zh-hant
      tags:
      - schema
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/vnd.oai.openapi:
              schema:
                type: object
                additionalProperties: {}
            application/yaml:
              schema:
                type: object
                additionalProperties: {}
            application/vnd.oai.openapi+json:
              schema:
                type: object
                additionalProperties: {}
            application/json:
              schema:
                type: object
                additionalProperties: {}
          description: ''
  /api/services-marketplace/:
    get:
      operationId: services_marketplace_list
      description: |-
        ViewSet lecture seule pour les services du marketplace.
        Ces services sont différents des publicités partenaires.

        Endpoints :
            GET /api/services-marketplace/ : Liste tous les services actifs
            GET /api/services-marketplace/{id}/ : Détail d'un service
      tags:
      - services-marketplace
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ServiceMarketplace'
          description: ''
  /api/services-marketplace/{id}/:
    get:
      operationId: services_marketplace_retrieve
      description: |-
        ViewSet lecture seule pour les services du marketplace.
        Ces services sont différents des publicités partenaires.

        Endpoints :
            GET /api/services-marketplace/ : Liste tous les services actifs
            GET /api/services-marketplace/{id}/ : Détail d'un service
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Service Marketplace.
        required: true
      tags:
      - services-marketplace
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceMarketplace'
          description: ''
  /api/stats/:
    get:
      operationId: stats_retrieve
      description: Retourne des statistiques sur les trajets, les lieux populaires,
        les records, etc.
      summary: Obtenir les statistiques globales
      tags:
      - stats
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                additionalProperties: {}
          description: ''
  /api/trajets/:
    get:
      operationId: trajets_list
      description: |-
        ViewSet CRUD pour Trajets (Lecture et Création uniquement).

        Endpoints :
            GET /api/trajets/ : Liste tous trajets
            POST /api/trajets/ : Créer nouveau trajet
            GET /api/trajets/{id}/ : Détail trajet
            GET /api/trajets/?heure=matin : Filtrage par heure
            GET /api/trajets/?meteo=1 : Filtrage par météo
            GET /api/trajets/?type_zone=0 : Filtrage par type zone

        Note: Modification (PUT/PATCH) et Suppression (DELETE) désactivées via API.
        Utilisé pour contribution communautaire (POST depuis frontend) et admin/debug.
      parameters:
      - in: query
        name: heure
        schema:
          type: string
          nullable: true
          title: Tranche horaire
          enum:
          - apres-midi
          - matin
          - nuit
          - soir
        description: |-
          Heure du trajet. Si null, déduire via datetime.now() au moment de l'ajout.

          * `matin` - Matin (6h-12h)
          * `apres-midi` - Après-midi (12h-18h)
          * `soir` - Soir (18h-22h)
          * `nuit` - Nuit (22h-6h)
      - in: query
        name: meteo
        schema:
          type: integer
      - in: query
        name: route_classe_dominante
        schema:
          type: string
      - in: query
        name: type_zone
        schema:
          type: integer
      tags:
      - trajets
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Trajet'
          description: ''
    post:
      operationId: trajets_create
      description: |-
        ViewSet CRUD pour Trajets (Lecture et Création uniquement).

        Endpoints :
            GET /api/trajets/ : Liste tous trajets
            POST /api/trajets/ : Créer nouveau trajet
            GET /api/trajets/{id}/ : Détail trajet
            GET /api/trajets/?heure=matin : Filtrage par heure
            GET /api/trajets/?meteo=1 : Filtrage par météo
            GET /api/trajets/?type_zone=0 : Filtrage par type zone

        Note: Modification (PUT/PATCH) et Suppression (DELETE) désactivées via API.
        Utilisé pour contribution communautaire (POST depuis frontend) et admin/debug.
      tags:
      - trajets
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Trajet'
        required: true
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trajet'
          description: ''
  /api/trajets/{id}/:
    get:
      operationId: trajets_retrieve
      description: |-
        ViewSet CRUD pour Trajets (Lecture et Création uniquement).

        Endpoints :
            GET /api/trajets/ : Liste tous trajets
            POST /api/trajets/ : Créer nouveau trajet
            GET /api/trajets/{id}/ : Détail trajet
            GET /api/trajets/?heure=matin : Filtrage par heure
            GET /api/trajets/?meteo=1 : Filtrage par météo
            GET /api/trajets/?type_zone=0 : Filtrage par type zone

        Note: Modification (PUT/PATCH) et Suppression (DELETE) désactivées via API.
        Utilisé pour contribution communautaire (POST depuis frontend) et admin/debug.
      parameters:
      - in: path
        name: id
        schema:
          type: integer
        description: A unique integer value identifying this Trajet.
        required: true
      tags:
      - trajets
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trajet'
          description: ''
  /api/trajets/stats/:
    get:
      operationId: trajets_stats_retrieve
      description: |-
        Endpoint stats globales trajets : /api/trajets/stats/

        Retourne :
            - Nombre total trajets
            - Prix moyen, min, max
            - Distance moyenne
            - Répartition par heure, météo, type zone

        JSON output :
            {
                "total_trajets": 150,
                "prix": {"moyen": 250, "min": 100, "max": 500},
                "distance_moyenne": 4800,
                "repartition_heure": {"matin": 50, "apres-midi": 40, ...},
                "repartition_meteo": {0: 80, 1: 40, ...},
                "repartition_zone": {0: 100, 1: 30, 2: 20}
            }
      tags:
      - trajets
      security:
      - tokenAuth: []
      - ApiKeyAuth: []
      - {}
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Trajet'
          description: ''
components:
  schemas:
    Abonnement:
      type: object
      description: Serializer pour les abonnements.
      properties:
        id:
          type: integer
          readOnly: true
        publicite:
          allOf:
          - $ref: '#/components/schemas/Publicite'
          readOnly: true
        offre:
          allOf:
          - $ref: '#/components/schemas/OffreAbonnement'
          readOnly: true
        date_debut:
          type: string
          format: date-time
          nullable: true
          title: Date de début
          description: Définie par l'admin après confirmation du paiement
        date_fin:
          type: string
          format: date-time
          nullable: true
          title: Date de fin
          description: Calculée automatiquement à partir de date_debut + durée offre
        statut:
          $ref: '#/components/schemas/AbonnementStatutEnum'
        montant_paye:
          type: string
          format: decimal
          pattern: ^-?\d{0,10}(?:\.\d{0,0})?$
          nullable: true
          title: Montant payé (CFA)
        reference_paiement:
          type: string
          nullable: true
          title: Référence paiement
          description: Référence ou note sur le paiement
          maxLength: 100
        est_expire:
          type: string
          readOnly: true
        jours_restants:
          type: string
          readOnly: true
        created_at:
          type: string
          format: date-time
          readOnly: true
          title: Date de souscription
      required:
      - created_at
      - est_expire
      - id
      - jours_restants
      - offre
      - publicite
    AbonnementStatutEnum:
      enum:
      - en_attente
      - actif
      - expire
      - annule
      type: string
      description: |-
        * `en_attente` - En attente de paiement
        * `actif` - Actif
        * `expire` - Expiré
        * `annule` - Annulé
    BlankEnum:
      enum:
      - ''
    EstimateInput:
      type: object
      description: |-
        Serializer pour valider inputs requête /estimate (POST ou GET).

        Validation et conversion :
            - Accepte départ/arrivée sous forme coords OU nom (flexible)
            - Si nom fourni, convertir vers coords via Nominatim
            - Si coords, valider format [lat, lon] ou {lat: X, lon: Y}
            - Variables optionnelles (heure, météo, type_zone, congestion_user) avec fallbacks

        Exemples JSON input :
            # Variante coords
            {
                "depart": {"lat": 3.8547, "lon": 11.5021},
                "arrivee": {"lat": 3.8667, "lon": 11.5174},
                "heure": "matin",  # optionnel
                "meteo": 1,        # optionnel
                "type_zone": 0,    # optionnel
                "congestion_user": 5  # optionnel
            }

            # Variante noms (conversion auto)
            {
                "depart": "Polytechnique Yaoundé",
                "arrivee": "Carrefour Ekounou",
                # autres champs optionnels
            }

            # Variante mixte
            {
                "depart": {"lat": 3.8547, "lon": 11.5021},
                "arrivee": "Carrefour Ekounou"
            }

        Après validation, attrs contiendra toujours :
            {
                "depart_coords": [lat, lon],
                "arrivee_coords": [lat, lon],
                "depart_label": str ou None,
                "arrivee_label": str ou None,
                "heure": str ou None,
                "meteo": int ou None,
                "type_zone": int ou None,
                "congestion_user": int ou None
            }
      properties:
        depart:
          description: Coords {lat, lon} ou nom POI (str)
        arrivee:
          description: Coords {lat, lon} ou nom POI (str)
        heure:
          nullable: true
          description: |-
            Tranche horaire. Si null, actuelle détectée.

            * `matin` - Matin (6h-12h)
            * `apres-midi` - Après-midi (12h-18h)
            * `soir` - Soir (18h-22h)
            * `nuit` - Nuit (22h-6h)
          oneOf:
          - $ref: '#/components/schemas/HeureEnum'
          - $ref: '#/components/schemas/NullEnum'
        meteo:
          type: integer
          maximum: 3
          minimum: 0
          nullable: true
          description: Code météo 0-3. Si null, détecté via OpenMeteo.
        type_zone:
          type: integer
          maximum: 2
          minimum: 0
          nullable: true
          description: Type zone 0-2. Si null, déduit routes Mapbox.
        congestion_user:
          type: integer
          maximum: 10
          minimum: 1
          nullable: true
          description: Niveau embouteillages utilisateur 1-10.
      required:
      - arrivee
      - depart
    EstimationsSupplementaires:
      type: object
      description: Estimations alternatives pour statut 'inconnu' (ML uniquement).
      properties:
        ml_prediction:
          type: integer
          nullable: true
        features_utilisees:
          allOf:
          - $ref: '#/components/schemas/FeaturesUtilisees'
          nullable: true
    FeaturesUtilisees:
      type: object
      description: Transparence sur les features passées au modèle ML.
      properties:
        distance_metres:
          type: number
          format: double
        duree_secondes:
          type: number
          format: double
        congestion:
          type: number
          format: double
          nullable: true
        sinuosite:
          type: number
          format: double
        nb_virages:
          type: integer
        heure:
          type: string
        meteo:
          type: integer
        type_zone:
          type: integer
      required:
      - congestion
      - distance_metres
      - duree_secondes
      - heure
      - meteo
      - nb_virages
      - sinuosite
      - type_zone
    HealthCheck:
      type: object
      description: Schéma pour /api/health/
      properties:
        status:
          type: string
        timestamp:
          type: string
        checks:
          type: object
          additionalProperties:
            type: string
      required:
      - checks
      - status
      - timestamp
    HeureEnum:
      enum:
      - matin
      - apres-midi
      - soir
      - nuit
      type: string
      description: |-
        * `matin` - Matin (6h-12h)
        * `apres-midi` - Après-midi (12h-18h)
        * `soir` - Soir (18h-22h)
        * `nuit` - Nuit (22h-6h)
    NullEnum:
      enum:
      - null
    OffreAbonnement:
      type: object
      description: Serializer pour les offres d'abonnement.
      properties:
        id:
          type: integer
          readOnly: true
        nom:
          type: string
          title: Nom de l'offre
          maxLength: 100
        duree_mois:
          type: integer
          maximum: 2147483647
          minimum: 0
          title: Durée (mois)
          description: Durée de l'abonnement en mois
        prix:
          type: string
          format: decimal
          pattern: ^-?\d{0,10}(?:\.\d{0,0})?$
          title: Prix (CFA)
          description: Prix de l'abonnement en Francs CFA
        description:
          type: string
          title: Description/Avantages
          description: Description détaillée de l'offre et ses avantages
        ordre_affichage:
          type: integer
          maximum: 2147483647
          minimum: 0
          title: Ordre d'affichage
          description: Ordre d'affichage sur la page pricing (0=premier)
        is_popular:
          type: boolean
          title: Offre populaire
          description: Met en valeur cette offre (badge 'Populaire')
        is_active:
          type: boolean
          title: Active
        created_at:
          type: string
          format: date-time
          readOnly: true
      required:
      - created_at
      - description
      - duree_mois
      - id
      - nom
      - prix
    PatchedPublicite:
      type: object
      description: |-
        Serializer pour le modèle Publicite (Services Partenaires).
        Inclut les informations d'abonnement pour l'affichage.
      properties:
        id:
          type: integer
          readOnly: true
        title:
          type: string
          title: Titre
          maxLength: 255
        title_en:
          type: string
          nullable: true
          title: Titre (EN)
          maxLength: 255
        description:
          type: string
        description_en:
          type: string
          nullable: true
          title: Description (EN)
        image_url:
          type: string
          format: uri
          title: URL de l'image
          maxLength: 500
        app_link:
          type: string
          format: uri
          nullable: true
          title: Lien de l'application
          maxLength: 500
        category:
          type: string
          title: Catégorie
          maxLength: 100
        color:
          type: string
          title: Couleur (HEX)
          maxLength: 7
        statut:
          $ref: '#/components/schemas/PubliciteStatutEnum'
        is_active:
          type: boolean
          title: Active
        contact_email:
          type: string
          format: email
          nullable: true
          title: Email de contact
          description: Email du gestionnaire de cette publicité
          maxLength: 254
        contact_telephone:
          type: string
          nullable: true
          title: Téléphone de contact
          description: Numéro WhatsApp/téléphone du gestionnaire
          maxLength: 20
        est_affichable:
          type: string
          readOnly: true
        created_at:
          type: string
          format: date-time
          readOnly: true
          title: Date d'ajout
    Point:
      type: object
      description: |-
        Serializer pour Point avec enrichissement automatique metadata administratives.

        Workflow création :
            1. User fournit coords (obligatoires) + optionnellement label
            2. Si label manque, reverse-geocode via Nominatim ou Mapbox pour obtenir POI/quartier
            3. Enrichir avec ville, quartier, arrondissement (via reverse geocoding)
            4. Sauvegarder Point complet

        Validation :
            - Coords entre -90/90 lat, -180/180 lon (géré par models validators)
            - Si coords hors Cameroun (détecté via reverse-geocode country_code != 'cm'), warning mais accepter

        Exemples JSON input :
            {
                "coords_latitude": 3.8547,
                "coords_longitude": 11.5021,
                "label": "École Polytechnique Yaoundé"  # Optionnel
            }

        Exemples JSON output :
            {
                "id": 1,
                "coords_latitude": 3.8547,
                "coords_longitude": 11.5021,
                "label": "École Polytechnique Yaoundé",
                "ville": "Yaoundé",
                "quartier": "Ngoa-Ekelle",
                "arrondissement": "Yaoundé I",
                "departement": "Mfoundi",
                "created_at": "2023-11-05T14:30:00Z"
            }
      properties:
        id:
          type: integer
          readOnly: true
        coords_latitude:
          type: number
          format: double
          maximum: 90.0
          minimum: -90.0
          title: Latitude
          description: Latitude décimale du point (ex. 3.8547). Validée entre -90
            et 90.
        coords_longitude:
          type: number
          format: double
          maximum: 180.0
          minimum: -180.0
          title: Longitude
          description: Longitude décimale du point (ex. 11.5021). Validée entre -180
            et 180.
        label:
          type: string
          title: Nom du POI
          description: Nom du point d'intérêt connu des taxis (ex. 'Carrefour Ekounou').
            Obtenu via Mapbox Search API.
          maxLength: 255
        ville:
          type: string
          nullable: true
          description: Ville du point (ex. 'Yaoundé'). Utilisé pour filtrage queries.
          maxLength: 100
        quartier:
          type: string
          nullable: true
          description: Quartier/sous-quartier (ex. 'Ngoa-Ekelle'). CRITIQUE pour filtrage
            similarité avant calculs Mapbox.
          maxLength: 100
        arrondissement:
          type: string
          nullable: true
          title: Arrondissement/Commune
          description: Commune (ex. 'Yaoundé II'). Extrait de 'context' Mapbox Geocoding.
          maxLength: 100
        departement:
          type: string
          nullable: true
          title: Département
          description: Département (ex. 'Mfoundi' pour Yaoundé). Fallback filtrage
            si quartier manque.
          maxLength: 100
        created_at:
          type: string
          format: date-time
          readOnly: true
          title: Date de création
        updated_at:
          type: string
          format: date-time
          readOnly: true
          title: Date de mise à jour
      required:
      - coords_latitude
      - coords_longitude
      - created_at
      - id
      - label
      - updated_at
    PredictionOutput:
      type: object
      description: |-
        Serializer pour réponse estimation prix (DTO non-persistant).

        Statut hiérarchique (exact/similaire/inconnu) avec prix, ajustements, fiabilité, message.
        Pour le statut "inconnu", seul le fallback ML est retourné avec transparence des features.
      properties:
        statut:
          allOf:
          - $ref: '#/components/schemas/PredictionOutputStatutEnum'
          description: |-
            Statut estimation : exact (match BD), similaire (ajusté), inconnu (fallbacks).

            * `exact` - exact
            * `similaire` - similaire
            * `inconnu` - inconnu
        prix_moyen:
          type: number
          format: double
          description: Prix moyen estimé en CFA.
        prix_min:
          type: number
          format: double
          nullable: true
          description: Prix minimal observé (si statut exact/similaire).
        prix_max:
          type: number
          format: double
          nullable: true
          description: Prix maximal observé (si statut exact/similaire).
        distance:
          type: number
          format: double
          nullable: true
          description: Distance du trajet en mètres (via Mapbox ou Haversine).
        duree:
          type: number
          format: double
          nullable: true
          description: Durée estimée du trajet en secondes.
        estimations_supplementaires:
          allOf:
          - $ref: '#/components/schemas/EstimationsSupplementaires'
          nullable: true
          description: (Inconnu) Fallback ML uniquement, avec features utilisées.
        ajustements_appliques:
          type: object
          additionalProperties: {}
          description: Ajustements prix (congestion, météo, sinuosité, heure) avec
            explications.
        fiabilite:
          type: number
          format: double
          maximum: 1.0
          minimum: 0.0
          nullable: true
          description: Score fiabilité 0-1 (basé sur nombre trajets similaires, variance
            prix).
        message:
          type: string
          description: Message explicatif pour utilisateur (ex. 'Basé sur 10 trajets').
        details_trajet:
          type: object
          additionalProperties: {}
          description: Détails techniques (distance, durée, congestion, météo utilisée).
        suggestions:
          type: array
          items:
            type: string
          description: Suggestions pour utilisateur (ex. 'Ajoutez votre prix après
            trajet').
      required:
      - fiabilite
      - message
      - prix_max
      - prix_min
      - prix_moyen
      - statut
    PredictionOutputStatutEnum:
      enum:
      - exact
      - similaire
      - inconnu
      type: string
      description: |-
        * `exact` - exact
        * `similaire` - similaire
        * `inconnu` - inconnu
    Publicite:
      type: object
      description: |-
        Serializer pour le modèle Publicite (Services Partenaires).
        Inclut les informations d'abonnement pour l'affichage.
      properties:
        id:
          type: integer
          readOnly: true
        title:
          type: string
          title: Titre
          maxLength: 255
        title_en:
          type: string
          nullable: true
          title: Titre (EN)
          maxLength: 255
        description:
          type: string
        description_en:
          type: string
          nullable: true
          title: Description (EN)
        image_url:
          type: string
          format: uri
          title: URL de l'image
          maxLength: 500
        app_link:
          type: string
          format: uri
          nullable: true
          title: Lien de l'application
          maxLength: 500
        category:
          type: string
          title: Catégorie
          maxLength: 100
        color:
          type: string
          title: Couleur (HEX)
          maxLength: 7
        statut:
          $ref: '#/components/schemas/PubliciteStatutEnum'
        is_active:
          type: boolean
          title: Active
        contact_email:
          type: string
          format: email
          nullable: true
          title: Email de contact
          description: Email du gestionnaire de cette publicité
          maxLength: 254
        contact_telephone:
          type: string
          nullable: true
          title: Téléphone de contact
          description: Numéro WhatsApp/téléphone du gestionnaire
          maxLength: 20
        est_affichable:
          type: string
          readOnly: true
        created_at:
          type: string
          format: date-time
          readOnly: true
          title: Date d'ajout
      required:
      - created_at
      - description
      - est_affichable
      - id
      - image_url
      - title
    PubliciteCreate:
      type: object
      description: |-
        Serializer pour créer une nouvelle publicité (souscription partenaire).
        Utilisé par le formulaire de souscription frontend.
      properties:
        title:
          type: string
          title: Titre
          maxLength: 255
        title_en:
          type: string
          nullable: true
          title: Titre (EN)
          maxLength: 255
        description:
          type: string
        description_en:
          type: string
          nullable: true
          title: Description (EN)
        image_url:
          type: string
          format: uri
          title: URL de l'image
          maxLength: 500
        app_link:
          type: string
          format: uri
          nullable: true
          title: Lien de l'application
          maxLength: 500
        category:
          type: string
          title: Catégorie
          maxLength: 100
        color:
          type: string
          title: Couleur (HEX)
          maxLength: 7
        contact_email:
          type: string
          format: email
          nullable: true
          title: Email de contact
          description: Email du gestionnaire de cette publicité
          maxLength: 254
        contact_telephone:
          type: string
          nullable: true
          title: Téléphone de contact
          description: Numéro WhatsApp/téléphone du gestionnaire
          maxLength: 20
        offre_id:
          type: integer
          writeOnly: true
          description: ID de l'offre d'abonnement choisie
      required:
      - description
      - image_url
      - offre_id
      - title
    PubliciteStatutEnum:
      enum:
      - en_attente
      - active
      - expiree
      - rejetee
      type: string
      description: |-
        * `en_attente` - En attente de validation
        * `active` - Active
        * `expiree` - Expirée
        * `rejetee` - Rejetée
    ServiceMarketplace:
      type: object
      description: Serializer pour les services de la marketplace (nos services).
      properties:
        id:
          type: integer
          readOnly: true
        nom:
          type: string
          title: Nom du service
          maxLength: 255
        nom_en:
          type: string
          nullable: true
          title: Nom (EN)
          maxLength: 255
        description:
          type: string
        description_en:
          type: string
          nullable: true
          title: Description (EN)
        image_url:
          type: string
          format: uri
          title: URL de l'image
          maxLength: 500
        lien_redirection:
          type: string
          format: uri
          title: Lien de redirection
          description: URL vers le service (app store, site web, etc.)
          maxLength: 500
        icone:
          type: string
          title: Icône
          description: 'Nom de l''icône Lucide (ex: Zap, Car, MapPin)'
          maxLength: 50
        couleur:
          type: string
          title: Couleur (HEX)
          maxLength: 7
        ordre_affichage:
          type: integer
          maximum: 2147483647
          minimum: 0
          title: Ordre d'affichage
        is_featured:
          type: boolean
          title: Mis en avant
          description: Afficher en priorité dans les suggestions
        is_active:
          type: boolean
          title: Actif
        created_at:
          type: string
          format: date-time
          readOnly: true
      required:
      - created_at
      - description
      - id
      - image_url
      - lien_redirection
      - nom
    Trajet:
      type: object
      description: |-
        Serializer pour Trajet avec validation, enrichissement Mapbox, et fallbacks.

        Workflow création complexe :
            1. Valider inputs (points départ/arrivée, prix obligatoires)
            2. Appliquer fallbacks variables optionnelles :
                - Heure null -> datetime.now() -> tranche (matin/après-midi/soir/nuit)
                - Météo null -> OpenMeteo API sur coords départ (ou moyenne départ/arrivée)
                - Type zone null -> déduit après appel Mapbox (classes routes dominante)
            3. Appeler Mapbox Directions API (driving-traffic, annotations complètes)
            4. Parser JSON Mapbox pour extraire :
                - Distance, durée (validation cohérence avec input si fourni)
                - Congestion moyenne (via extract_congestion_moyen)
                - Sinuosité (via calculate_sinuosite_from_mapbox_data du modèle)
                - Classe route dominante, nb virages, force virages
            5. Gérer données Mapbox manquantes (fallbacks : congestion=50 urbain, sinuosité=1.0)
            6. Sauvegarder Trajet enrichi

        Validation :
            - Prix > 0
            - Points départ != arrivée (vérifier coords différentes)
            - Si distance fournie par user, valider cohérence avec Mapbox (tolérance ±20%)

        Exemples JSON input :
            {
                "point_depart": {
                    "coords_latitude": 3.8547,
                    "coords_longitude": 11.5021,
                    "label": "Polytechnique Yaoundé"
                },
                "point_arrivee": {
                    "coords_latitude": 3.8667,
                    "coords_longitude": 11.5174,
                    "label": "Carrefour Ekounou"
                },
                "prix": 200,
                "heure": "matin",  # ou null
                "meteo": 1,        # ou null
                "type_zone": 0,    # ou null
                "congestion_user": 5  # optionnel
            }

        Exemples JSON output :
            {
                "id": 1,
                "point_depart": {...},  # Point complet
                "point_arrivee": {...},
                "distance": 5212.5,
                "prix": 200,
                "heure": "matin",
                "meteo": 1,
                "type_zone": 0,
                "congestion_user": 5,
                "congestion_moyen": 42.3,  # Enrichi Mapbox
                "sinuosite_indice": 2.48,
                "route_classe_dominante": "primary",
                "nb_virages": 7,
                "force_virages": 68.5,
                "duree_estimee": 780.0,
                "date_ajout": "2023-11-05T14:30:00Z"
            }
      properties:
        id:
          type: integer
          readOnly: true
        point_depart:
          $ref: '#/components/schemas/Point'
        point_arrivee:
          $ref: '#/components/schemas/Point'
        distance:
          type: number
          format: double
          readOnly: true
          title: Distance (mètres)
          description: Distance routière via Mapbox Directions API (driving-traffic).
            Inclut détours réels.
        prix:
          type: number
          format: double
          minimum: 0.0
          title: Prix payé (CFA)
          description: Prix réel payé par utilisateur en Francs CFA. Donnée cruciale
            pour estimations communautaires.
        heure:
          nullable: true
          title: Tranche horaire
          description: |-
            Heure du trajet. Si null, déduire via datetime.now() au moment de l'ajout.

            * `matin` - Matin (6h-12h)
            * `apres-midi` - Après-midi (12h-18h)
            * `soir` - Soir (18h-22h)
            * `nuit` - Nuit (22h-6h)
          oneOf:
          - $ref: '#/components/schemas/HeureEnum'
          - $ref: '#/components/schemas/BlankEnum'
          - $ref: '#/components/schemas/NullEnum'
        meteo:
          type: integer
          maximum: 3
          minimum: 0
          nullable: true
          title: Code météo
          description: 0=Soleil, 1=Pluie légère, 2=Pluie forte, 3=Orage. Si null,
            appeler OpenMeteo API.
        type_zone:
          type: integer
          maximum: 2
          minimum: 0
          nullable: true
          title: Type de zone
          description: 0=Urbaine, 1=Mixte, 2=Rurale. Si null, déduire via classes
            routes Mapbox (primary=urbaine).
        congestion_user:
          type: integer
          maximum: 10
          minimum: 1
          nullable: true
          title: Congestion utilisateur (1-10)
          description: Niveau embouteillages selon user (1=fluide, 10=bloqué). Complète
            Mapbox pour zones non couvertes.
        qualite_trajet:
          type: integer
          maximum: 10
          minimum: 1
          title: Qualité/Difficulté du trajet (1-10)
          description: 'Évaluation utilisateur de la difficulté du trajet (1=très
            facile/fluide, 10=très difficile/embouteillages/nids de poule). Valeur
            par défaut: 5 (normal). Paramètre culturel utilisé pour ML futur.'
        congestion_moyen:
          type: number
          format: double
          readOnly: true
          nullable: true
          title: Congestion Mapbox (0-100)
          description: Moyenne congestion segments Mapbox. Null si 'unknown' pour
            tous segments (fréquent Cameroun).
        sinuosite_indice:
          type: number
          format: double
          readOnly: true
          nullable: true
          title: Indice de sinuosité
          description: Ratio distance/ligne droite ou force virages (°/km). 1.0=droit,
            >1.5=sinueux. Null si calcul échoue.
        route_classe_dominante:
          type: string
          readOnly: true
          nullable: true
          title: Classe route dominante
          description: '''primary'', ''secondary'', ''tertiary'', etc. via Mapbox
            Streets v8. Null si indisponible.'
        nb_virages:
          type: integer
          readOnly: true
          nullable: true
          title: Nombre de virages
          description: Nombre maneuvers type 'turn'/'rotary' dans itinéraire Mapbox.
        force_virages:
          type: number
          format: double
          readOnly: true
          nullable: true
          title: Force virages (°/km)
          description: Somme |bearing_before - bearing_after| / distance_km. Mesure
            complexité itinéraire.
        duree_estimee:
          type: number
          format: double
          readOnly: true
          nullable: true
          title: Durée estimée (secondes)
          description: Durée via Mapbox avec trafic. Pour info uniquement.
        date_ajout:
          type: string
          format: date-time
          readOnly: true
          title: Date d'ajout
          description: Timestamp ajout trajet par utilisateur.
        updated_at:
          type: string
          format: date-time
          readOnly: true
      required:
      - congestion_moyen
      - date_ajout
      - distance
      - duree_estimee
      - force_virages
      - id
      - nb_virages
      - point_arrivee
      - point_depart
      - prix
      - route_classe_dominante
      - sinuosite_indice
      - updated_at
  securitySchemes:
    tokenAuth:
      type: apiKey
      in: header
      name: Authorization
      description: Token-based authentication with required prefix "ApiKey"
